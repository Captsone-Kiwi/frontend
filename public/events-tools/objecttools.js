var gdjs;(function(c){let y;(function(j){let d;(function(g){g.pickOnly=function(n,t){for(const e in n.items)if(n.items.hasOwnProperty(e)){const s=n.items[e];s.indexOf(t)===-1?s.length=0:(s.length=0,s.push(t))}},g.twoListsTest=function(n,t,e,s,o){let f=!1;const r=c.staticArray(c.evtTools.object.twoListsTest);t.values(r);const u=c.staticArray2(c.evtTools.object.twoListsTest);e.values(u);for(let a=0,O=r.length;a<O;++a){let i=r[a];for(let l=0,p=i.length;l<p;++l)i[l].pick=!1}for(let a=0,O=u.length;a<O;++a){let i=u[a];for(let l=0,p=i.length;l<p;++l)i[l].pick=!1}for(let a=0,O=r.length;a<O;++a){const i=r[a];for(let l=0,p=i.length;l<p;++l){let b=!1;for(let T=0,k=u.length;T<k;++T){const m=u[T];for(let h=0,w=m.length;h<w;++h)i[l].pick&&m[h].pick||i[l].id!==m[h].id&&n(i[l],m[h],o)&&(s||(f=!0,i[l].pick=!0,m[h].pick=!0),b=!0)}!b&&s&&(f=!0,i[l].pick=!0)}}for(let a=0,O=r.length;a<O;++a){let i=r[a],l=0;for(let p=0,b=i.length;p<b;++p){let T=i[p];i[p].pick&&(i[l]=T,l++)}i.length=l}if(!s)for(let a=0,O=u.length;a<O;++a){let i=u[a],l=0;for(let p=0,b=i.length;p<b;++p){let T=i[p];i[p].pick&&(i[l]=T,l++)}i.length=l}return f},g.pickObjectsIf=function(n,t,e,s){let o=!1;const f=c.staticArray(c.evtTools.object.pickObjectsIf);t.values(f);for(let r=0,u=f.length;r<u;++r){const a=f[r];for(let O=0,i=a.length;O<i;++O){const l=a[O];e^n(l,s)?(o=!0,l.pick=!0):l.pick=!1}}for(let r=0,u=f.length;r<u;++r)c.evtTools.object.filterPickedObjectsList(f[r]);return o},g.filterPickedObjectsList=function(n){let t=0;for(let e=0,s=n.length;e<s;++e){const o=n[e];o.pick&&(n[t]=o,t++)}n.length=t},g.hitBoxesCollisionTest=function(n,t,e,s,o){return c.evtTools.object.twoListsTest(c.RuntimeObject.collisionTest,n,t,e,o)},g._distanceBetweenObjects=function(n,t,e){return n.getSqDistanceToObject(t)<=e},g.distanceTest=function(n,t,e,s){return c.evtTools.object.twoListsTest(c.evtTools.object._distanceBetweenObjects,n,t,s,e*e)},g._movesToward=function(n,t,e){if(n.hasNoForces())return!1;let s=Math.atan2(t.getDrawableY()+t.getCenterY()-(n.getDrawableY()+n.getCenterY()),t.getDrawableX()+t.getCenterX()-(n.getDrawableX()+n.getCenterX()));return s*=180/3.14159,Math.abs(c.evtTools.common.angleDifference(n.getAverageForce().getAngle(),s))<=e/2},g.movesTowardTest=function(n,t,e,s){return c.evtTools.object.twoListsTest(c.evtTools.object._movesToward,n,t,s,e)},g._turnedToward=function(n,t,e){let s=Math.atan2(t.getDrawableY()+t.getCenterY()-(n.getDrawableY()+n.getCenterY()),t.getDrawableX()+t.getCenterX()-(n.getDrawableX()+n.getCenterX()));return s*=180/3.14159,Math.abs(c.evtTools.common.angleDifference(n.getAngle(),s))<=e/2},g.turnedTowardTest=function(n,t,e,s){return c.evtTools.object.twoListsTest(c.evtTools.object._turnedToward,n,t,s,e)},g.pickAllObjects=function(n,t){for(const e in t.items)if(t.items.hasOwnProperty(e)){const s=n.getObjects(e),o=t.items[e];o.length=0,o.push.apply(o,s)}return!0},g.pickRandomObject=function(n,t){let e=0;for(let r in t.items)t.items.hasOwnProperty(r)&&(e+=t.items[r].length);if(e===0)return!1;let s=Math.floor(Math.random()*e);s>=e&&(s=e-1);let o=0,f=null;for(let r in t.items)if(t.items.hasOwnProperty(r)){let u=t.items[r];if(s-o<u.length){f=u[s-o];break}o+=u.length}return c.evtTools.object.pickOnly(t,f),!0},g.pickNearestObject=function(n,t,e,s){let o=null,f=0,r=!0;const u=c.staticArray(c.evtTools.object.pickNearestObject);n.values(u);for(let a=0,O=u.length;a<O;++a){const i=u[a];for(let l=0;l<i.length;++l){const p=i[l],b=p.getSqDistanceToPosition(t,e);(r||b<f^s)&&(f=b,o=p),r=!1}}return o?(c.evtTools.object.pickOnly(n,o),!0):!1},g.raycastObject=function(n,t,e,s,o,f,r,u){return c.evtTools.object.raycastObjectToPosition(n,t,e,t+o*Math.cos(s*Math.PI/180),e+o*Math.sin(s*Math.PI/180),f,r,u)},g.raycastObjectToPosition=function(n,t,e,s,o,f,r,u){let a=null,O=u?0:(s-t)*(s-t)+(o-e)*(o-e),i=0,l=0;const p=c.staticArray(c.evtTools.object.raycastObjectToPosition);n.values(p);for(let b=0;b<p.length;b++){const T=p[b];for(let k=0;k<T.length;k++){const m=T[k],h=m.raycastTest(t,e,s,o,!u);h.collision&&(!u&&h.closeSqDist<=O?(O=h.closeSqDist,a=m,i=h.closeX,l=h.closeY):u&&h.farSqDist>=O&&(O=h.farSqDist,a=m,i=h.farX,l=h.farY))}}return a?(c.evtTools.object.pickOnly(n,a),f.setNumber(i),r.setNumber(l),!0):!1},g.doCreateObjectOnScene=function(n,t,e,s,o,f){const r=n.createObject(t),u=n.getLayer(f);r!==null&&(r.setPosition(s,o),r.setLayer(f),r.setZOrder(u.getDefaultZOrder()),e.containsKey(t)&&e.get(t).push(r))},g.createObjectOnScene=function(n,t,e,s,o){c.evtTools.object.doCreateObjectOnScene(n,t.firstKey(),t,e,s,o)},g.createObjectFromGroupOnScene=function(n,t,e,s,o,f){c.evtTools.object.doCreateObjectOnScene(n,e,t,s,o,f)},g.getPickedInstancesCount=n=>{let t=0;const e=c.staticArray(c.evtTools.object.getPickedInstancesCount);n.values(e);for(let s=0,o=e.length;s<o;++s)t+=e[s].length;return t},g.getSceneInstancesCount=(n,t)=>{let e=0;const s=c.staticArray(c.evtTools.object.getSceneInstancesCount);t.keys(s);const o=new Set(s);for(const f of o)e+=n.getInstancesCountOnScene(f);return e},g.pickedObjectsCount=g.getPickedInstancesCount})(d=j.object||(j.object={}))})(y=c.evtTools||(c.evtTools={}))})(gdjs||(gdjs={}));
//# sourceMappingURL=objecttools.js.map
